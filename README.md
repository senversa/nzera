# NZERA R-Package Demo

Environment and Toxicology modelling tools for Aotearoa

**Transparent, Reproducible, and Standardised Environmental Risk Tools**

This repository contains a demonstration scaffold for the **New Zealand Ecological Risk Modelling Framework**, which will be an integrated R-based system for developing, documenting, validating, and deploying ecological and contaminant-risk models. It is designed for regulatory environments, multi-expert collaboration, and open-source delivery.

## Purpose

The demonstration framework provides an example of a consistent and auditable structure for developing ecological risk models related to contaminants, pesticides, and environmental stressors across diverse ecosystems.

It ensures that every model developed under this framework is:

- **Transparent** all assumptions, data sources, and equations are fully documented.
- **Reproducible** models can be re-run, validated, and audited without proprietary tools.
- **Standardised** every model follows the same structure, interfaces, metadata requirements, and validation rules.
- **Extensible** new models can be added quickly and consistently.

---

## Key Features

### Model Standardisation

All models implement three required functions:

- `model_<id>_run()` — executes the model
- `model_<id>_metadata()` — declares model identity, version, owners, and references
- `model_<id>_schema()` — defines required input fields, units, and validation rules

This ensures consistent interfaces across multiple subject-matter experts (SMEs).

---

### Quarto-First Documentation

Each model has an associated **Quarto document** that includes:

- scientific background
- equations and conceptual model
- references and data sources
- assumptions, limitations, and decisions
- a full development log
- validation and sensitivity analysis

This delivers traceability from scientific reasoning → model code → final implementation.

---

### Central Discovery & Registry

The framework automatically discovers available models through naming conventions.
No manual registry editing required.

Utilities include:

- `discover_model_ids()`
- `get_model_metadata()`
- `get_model_schema()`
- `get_all_model_metadata()`

These power all catalogues, UIs, APIs, and validation pipelines.

---

### Schema-Driven Validation

All input data is validated against the model’s schema via:

```r
validate_input(data, schema)
```

This enforces:

- required fields
- type checks
- unit awareness
- structure constraints
- optional strict mode for regulated data submissions

Templates can be autogenerated using:

```r
write_input_template(model_id)
```

---

### Testing & Quality Assurance

Each model includes:

- unit tests
- input validation tests
- example regression tests

All tests run under **testthat**, using a package-standard workflow.

---

### Deployment Options

The framework can be deployed through:

- **R package installation** for analysts
- **Shiny app** for non-technical users
- **REST API (Plumber)** for system-to-system integration

---

## Development Project Draft Structure

```
nzera/
├── DESCRIPTION
├── NAMESPACE
├── R/                           # Core framework code for model functions & utilities
├── model_docs/
│   ├── template/                # Quarto documentation template
│   └── <model_id>/              # SME-prepared narrative docs
├── tests/testthat/              # Core framework tests
│   └── test_<model_id>.R        # Unit tests per model
├── docs/
│   ├── framework_overview.qmd   # High-level explanation
│   └── model_catalogue.qmd      # Auto-generated list of models
├── app/
│   ├── shiny_app.R              # Optional web UI
│   └── api_plumber.R            # Optional REST API
├── data/
│   ├── input_templates/         # Model-specific templates
│   ├── example_inputs/          # Example datasets
│   └── example_outputs/         # Example outputs
└── .gitignore
```

---

## Load the Demo Package

Run:

```r
setwd("path/to/nzera")  # Set to the package root directory
devtools::load_all()
```

## Adding a New Model

Run:

```r
new_model_skeleton("model_id_here", title = "Human-Readable Title")
```

This automatically generates:

1. `model_docs/<id>/<id>.qmd` – SME documentation stub
2. `R/models/model_<id>.R` – run/metadata/schema stubs
3. `tests/test_<id>.R` – test skeleton
4. Input template (optional)

From there:

- SMEs fill out the Quarto doc
- Core modellers extract final logic into `model_<id>_run()`
- QA reviews and updates lifecycle status

---

## Model Lifecycle

Each model has a `status` field:

- **draft** SME development in progress
- **under_review** undergoing QA/regulator review
- **approved** authorised for use
- **deprecated** retained for traceability only

The lifecycle is reflected across:

- documentation,
- UI selection,
- metadata,
- and tests.

---

## Running Models

First load the demo functions:

```r
setwd("path/to/nzera")  # Set to the package root directory
devtools::load_all()
```

List all available models:

```r
list_models()
```

Run a specific model:

```r
run_model("example_pesticide", data)
```

Validate automatically using the model’s schema:

```r
validate_input(data, get_model_schema("example_pesticide"))
```

---

## Transparency & Regulatory Alignment

The framework is built around the following regulatory principles:

- **Reproducibility**
- **Auditability**
- **Justification of assumptions**
- **Full traceability from literature → code → outputs**
- **Versioning and change logs**
- **Clear model ownership**

This ensures that models can be reviewed, approved, re-run, or adapted by internal teams, external consultants, or regulators themselves.

---

## Contact & Support

This draft framework has been designed for collaborative development across multiple technical contributors, SMEs, and regulatory authorities.
Support, onboarding documentation, and example models are included in the `/docs` and `/model_docs` folders.
